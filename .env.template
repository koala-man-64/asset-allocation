# ==========================================
# Local Development & Logging
# ==========================================
DISABLE_DOTENV=false
LOG_FORMAT=JSON
LOG_LEVEL=INFO
TEST_MODE=false
ENABLE_ENV_DIAGNOSTICS=false

# Optional: debugging + tuning
DEBUG_SYMBOLS= # Fallback when Postgres debug_symbols is not configured (e.g. AAPL,MSFT)
SYMBOLS_REFRESH_INTERVAL_HOURS=24 # 0 disables periodic symbol refresh
FEATURE_ENGINEERING_MAX_WORKERS=
DOMAIN_METADATA_MAX_SCANNED_BLOBS=200000
ASSET_ALLOCATION_REQUIRE_AZURE_STORAGE=

# ==========================================
# Azure Identity (GitHub deploy + optional local auth)
# ==========================================
# Required for GitHub Actions OIDC deploy:
AZURE_CLIENT_ID=
AZURE_TENANT_ID=
AZURE_SUBSCRIPTION_ID=
# Optional: Service Principal client secret (not required for GitHub OIDC)
AZURE_CLIENT_SECRET=

# ==========================================
# Azure Storage (required for pipelines)
# ==========================================
AZURE_STORAGE_ACCOUNT_NAME=
AZURE_STORAGE_CONNECTION_STRING=
# Optional auth alternatives (Delta Lake / blob access)
AZURE_STORAGE_ACCOUNT_KEY=
AZURE_STORAGE_ACCESS_KEY=
AZURE_STORAGE_SAS_TOKEN=

# ==========================================
# External Data APIs
# ==========================================
ALPHA_VANTAGE_API_KEY=
ALPHA_VANTAGE_RATE_LIMIT_PER_MIN=300
ALPHA_VANTAGE_TIMEOUT_SECONDS=15
ALPHA_VANTAGE_MAX_WORKERS=32
ALPHA_VANTAGE_EARNINGS_FRESH_DAYS=7
ALPHA_VANTAGE_FINANCE_FRESH_DAYS=28
NASDAQ_API_KEY=

# ==========================================
# ETL -> API Gateway (Alpha Vantage via API)
# ==========================================
ASSET_ALLOCATION_API_BASE_URL= # local: http://localhost:8000 | Azure Jobs: http://asset-allocation-api (no port)
ASSET_ALLOCATION_API_KEY= # optional if API_AUTH_MODE=none; otherwise set to the API key
ASSET_ALLOCATION_API_KEY_HEADER=X-API-Key
ASSET_ALLOCATION_API_TIMEOUT_SECONDS=120
ASSET_ALLOCATION_API_ALLOW_NO_AUTH=false

# ==========================================
# Storage Containers & Folders (canonical names)
# ==========================================
AZURE_CONTAINER_COMMON=common
AZURE_CONTAINER_BRONZE=bronze
AZURE_CONTAINER_SILVER=silver
AZURE_CONTAINER_GOLD=gold
AZURE_CONTAINER_PLATINUM=platinum
AZURE_FOLDER_MARKET=market-data
AZURE_FOLDER_FINANCE=finance-data
AZURE_FOLDER_EARNINGS=earnings-data
AZURE_FOLDER_TARGETS=price-target-data

# ==========================================
# Postgres
# ==========================================
POSTGRES_DSN=

# ==========================================
# API Service
# ==========================================
API_AUTH_MODE=none # none|api_key|oidc|api_key_or_oidc
API_KEY=
API_KEY_HEADER=X-API-Key
API_ROOT_PREFIX= # e.g. asset-allocation (optional path prefix to mount the API under /{API_ROOT_PREFIX}/api/*)
API_PORT=8000
API_CSP=
API_CORS_ALLOW_ORIGINS= # comma-separated or JSON list; e.g. http://localhost:5173,http://127.0.0.1:5173
API_OIDC_ISSUER=
API_OIDC_AUDIENCE=
API_OIDC_JWKS_URL=
API_OIDC_REQUIRED_SCOPES=
API_OIDC_REQUIRED_ROLES=

UI_AUTH_MODE=
UI_OIDC_CLIENT_ID=
UI_OIDC_AUTHORITY=
UI_OIDC_SCOPES=
UI_OIDC_REDIRECT_URI=
UI_API_BASE_URL=
UI_DIST_DIR=
RUNTIME_CONFIG_REFRESH_SECONDS=60 # API only: poll Postgres for runtime-config/debug-symbol changes (min 5s)

# ==========================================
# System Health Monitoring (FastAPI: GET /api/system/health)
# ==========================================
SYSTEM_HEALTH_TTL_SECONDS=10
SYSTEM_HEALTH_MAX_AGE_SECONDS=129600
SYSTEM_HEALTH_VERBOSE_IDS=

# Optional: Azure control-plane probes (ARM) for Container Apps + Jobs
SYSTEM_HEALTH_ARM_SUBSCRIPTION_ID=
SYSTEM_HEALTH_ARM_RESOURCE_GROUP=
SYSTEM_HEALTH_ARM_CONTAINERAPPS= # comma-separated names
SYSTEM_HEALTH_ARM_JOBS= # comma-separated names
SYSTEM_HEALTH_ARM_API_VERSION=
SYSTEM_HEALTH_ARM_TIMEOUT_SECONDS=
SYSTEM_HEALTH_JOB_EXECUTIONS_PER_JOB=

# Optional: Azure Resource Health (runtime availability)
SYSTEM_HEALTH_RESOURCE_HEALTH_ENABLED=
SYSTEM_HEALTH_RESOURCE_HEALTH_API_VERSION=

# Optional: Azure Monitor Metrics (runtime telemetry)
SYSTEM_HEALTH_MONITOR_METRICS_ENABLED=
SYSTEM_HEALTH_MONITOR_METRICS_API_VERSION=
SYSTEM_HEALTH_MONITOR_METRICS_TIMESPAN_MINUTES=
SYSTEM_HEALTH_MONITOR_METRICS_INTERVAL=
SYSTEM_HEALTH_MONITOR_METRICS_AGGREGATION=
SYSTEM_HEALTH_MONITOR_METRICS_CONTAINERAPP_METRICS= # comma-separated metric names
SYSTEM_HEALTH_MONITOR_METRICS_JOB_METRICS= # comma-separated metric names
SYSTEM_HEALTH_MONITOR_METRICS_THRESHOLDS_JSON= # JSON object: {"MetricName":{"warn_above":80,"error_above":95}}

# Optional: Azure Log Analytics (KQL aggregates + job execution log tails)
SYSTEM_HEALTH_LOG_ANALYTICS_ENABLED=
SYSTEM_HEALTH_LOG_ANALYTICS_WORKSPACE_ID=
SYSTEM_HEALTH_LOG_ANALYTICS_TIMEOUT_SECONDS=
SYSTEM_HEALTH_LOG_ANALYTICS_TIMESPAN_MINUTES=
SYSTEM_HEALTH_LOG_ANALYTICS_QUERIES_JSON= # JSON array: [{"resourceType":"Microsoft.App/containerApps","name":"errors_15m","query":"... {resourceName} ...","warnAbove":1,"errorAbove":10,"unit":"count"}]
# Example (single-line JSON; paste and adjust thresholds as needed):
# SYSTEM_HEALTH_LOG_ANALYTICS_QUERIES_JSON=[{"resourceType":"Microsoft.App/jobs","name":"job_errors_15m","query":"ContainerAppConsoleLogs_CL|where TimeGenerated>ago(15m)|where ContainerJobName_s=='{resourceName}'|extend j=parse_json(Log_s)|extend level=tostring(j.level)|where Stream_s=='stderr' or level in ('ERROR','CRITICAL') or Log_s has 'Traceback'|summarize count()","warnAbove":1,"errorAbove":10,"unit":"count"},{"resourceType":"Microsoft.App/containerApps","name":"app_errors_15m","query":"ContainerAppConsoleLogs_CL|where TimeGenerated>ago(15m)|where ContainerAppName_s=='{resourceName}'|extend j=parse_json(Log_s)|extend level=tostring(j.level)|where Stream_s=='stderr' or level in ('ERROR','CRITICAL') or Log_s has 'Traceback'|summarize count()","warnAbove":1,"errorAbove":10,"unit":"count"}]

# ==========================================
# Pipeline Controls
# ==========================================
SILVER_LATEST_ONLY= # default true for market/earnings
SILVER_MARKET_LATEST_ONLY=
SILVER_FINANCE_LATEST_ONLY=
SILVER_EARNINGS_LATEST_ONLY=
SILVER_PRICE_TARGET_LATEST_ONLY=
BACKFILL_START_DATE= # YYYY-MM-DD (optional)
BACKFILL_END_DATE= # YYYY-MM-DD (optional)
MATERIALIZE_YEAR_MONTH= # YYYY-MM (optional)
MATERIALIZE_WINDOW_MONTHS= # default 1 (yesterday's month)
MATERIALIZE_BY_DATE_RUN_AT_UTC_HOUR=
TRIGGER_NEXT_JOB_NAME=
TRIGGER_NEXT_JOB_REQUIRED=
TRIGGER_NEXT_JOB_RETRY_ATTEMPTS= # default 3
TRIGGER_NEXT_JOB_RETRY_BASE_SECONDS= # default 1.0

# ==========================================
# UI / CI Variables (GitHub Variables)
# ==========================================
VITE_PORT=5174
VITE_PROXY_CONFIG_JS=false # UI dev only: when true, proxy /config.js to the API (instead of serving ui/public/config.js)
VITE_API_PROXY_TARGET=http://127.0.0.1:8000 # UI dev only: Vite proxy target for /api (do not include /api)
SERVICE_ACCOUNT_NAME=asset-allocation-sa
KUBERNETES_NAMESPACE=
AKS_CLUSTER_NAME=
