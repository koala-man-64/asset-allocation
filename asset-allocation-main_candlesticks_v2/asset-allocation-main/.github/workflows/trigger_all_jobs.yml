name: Manual Job Trigger

on:
  workflow_dispatch:
    inputs:
      job:
        description: Job to start (use job key or `all` to trigger everything)
        required: false
        default: all

permissions:
  id-token: write
  contents: read

env:
  RESOURCE_GROUP: AssetAllocationRG
  # Bronze
  BRONZE_MARKET_JOB: bronze-market-job
  BRONZE_FINANCE_JOB: bronze-finance-job
  BRONZE_PRICE_TARGET_JOB: bronze-price-target-job
  BRONZE_EARNINGS_JOB: bronze-earnings-job
  # Silver
  SILVER_MARKET_JOB: silver-market-job
  SILVER_FINANCE_JOB: silver-finance-job
  SILVER_PRICE_TARGET_JOB: silver-price-target-job
  SILVER_EARNINGS_JOB: silver-earnings-job
  # Gold
  GOLD_MARKET_JOB: gold-market-job
  GOLD_CANDLESTICKS_JOB: gold-candlesticks-job
  GOLD_FINANCE_JOB: gold-finance-job
  GOLD_PRICE_TARGET_JOB: gold-price-target-job
  GOLD_EARNINGS_JOB: gold-earnings-job

jobs:
  trigger-jobs:
    if: github.ref == 'refs/heads/main'
    environment:
      name: production
    runs-on: ubuntu-22.04
    steps:
      - name: Azure Login
        uses: azure/login@a457da9ea143d694b1b9c7c869ebb04ebe844ef5 # v2
        with:
          client-id: ${{ secrets.AZURE_CLIENT_ID }}
          tenant-id: ${{ secrets.AZURE_TENANT_ID }}
          subscription-id: ${{ secrets.AZURE_SUBSCRIPTION_ID }}

      # --- Bronze ---
      - name: Trigger Market Bronze Job
        if: ${{ github.event.inputs.job == 'all' || github.event.inputs.job == 'bronze_market' || github.event.inputs.job == 'market-data' }}
        run: az containerapp job start --name ${{ env.BRONZE_MARKET_JOB }} --resource-group ${{ env.RESOURCE_GROUP }}

      - name: Trigger Finance Bronze Job
        if: ${{ github.event.inputs.job == 'all' || github.event.inputs.job == 'bronze_finance' || github.event.inputs.job == 'finance-data' }}
        run: az containerapp job start --name ${{ env.BRONZE_FINANCE_JOB }} --resource-group ${{ env.RESOURCE_GROUP }}

      - name: Trigger Price Target Bronze Job
        if: ${{ github.event.inputs.job == 'all' || github.event.inputs.job == 'bronze_price_target' || github.event.inputs.job == 'price-target' }}
        run: az containerapp job start --name ${{ env.BRONZE_PRICE_TARGET_JOB }} --resource-group ${{ env.RESOURCE_GROUP }}

      - name: Trigger Earnings Bronze Job
        if: ${{ github.event.inputs.job == 'all' || github.event.inputs.job == 'bronze_earnings' || github.event.inputs.job == 'earnings-data' }}
        run: az containerapp job start --name ${{ env.BRONZE_EARNINGS_JOB }} --resource-group ${{ env.RESOURCE_GROUP }}

      # --- Silver ---
      - name: Trigger Market Silver Job
        if: ${{ github.event.inputs.job == 'all' || github.event.inputs.job == 'silver_market' || github.event.inputs.job == 'silver_market_by_date' }}
        run: az containerapp job start --name ${{ env.SILVER_MARKET_JOB }} --resource-group ${{ env.RESOURCE_GROUP }}

      - name: Trigger Finance Silver Job
        if: ${{ github.event.inputs.job == 'all' || github.event.inputs.job == 'silver_finance' || github.event.inputs.job == 'silver_finance_by_date' }}
        run: az containerapp job start --name ${{ env.SILVER_FINANCE_JOB }} --resource-group ${{ env.RESOURCE_GROUP }}

      - name: Trigger Price Target Silver Job
        if: ${{ github.event.inputs.job == 'all' || github.event.inputs.job == 'silver_price_target' || github.event.inputs.job == 'silver_price_target_by_date' }}
        run: az containerapp job start --name ${{ env.SILVER_PRICE_TARGET_JOB }} --resource-group ${{ env.RESOURCE_GROUP }}

      - name: Trigger Earnings Silver Job
        if: ${{ github.event.inputs.job == 'all' || github.event.inputs.job == 'silver_earnings' || github.event.inputs.job == 'silver_earnings_by_date' }}
        run: az containerapp job start --name ${{ env.SILVER_EARNINGS_JOB }} --resource-group ${{ env.RESOURCE_GROUP }}

      # --- Gold ---
      - name: Trigger Market Gold Job
        if: ${{ github.event.inputs.job == 'all' || github.event.inputs.job == 'gold_market' || github.event.inputs.job == 'gold_market_by_date' }}
        run: az containerapp job start --name ${{ env.GOLD_MARKET_JOB }} --resource-group ${{ env.RESOURCE_GROUP }}

      - name: Trigger Candlesticks Gold Job
        if: ${{ github.event.inputs.job == 'all' || github.event.inputs.job == 'gold_candlesticks' || github.event.inputs.job == 'candlesticks' }}
        run: az containerapp job start --name ${{ env.GOLD_CANDLESTICKS_JOB }} --resource-group ${{ env.RESOURCE_GROUP }}

      - name: Trigger Finance Gold Job
        if: ${{ github.event.inputs.job == 'all' || github.event.inputs.job == 'gold_finance' || github.event.inputs.job == 'gold_finance_by_date' }}
        run: az containerapp job start --name ${{ env.GOLD_FINANCE_JOB }} --resource-group ${{ env.RESOURCE_GROUP }}

      - name: Trigger Price Target Gold Job
        if: ${{ github.event.inputs.job == 'all' || github.event.inputs.job == 'gold_price_target' || github.event.inputs.job == 'gold_price_target_by_date' }}
        run: az containerapp job start --name ${{ env.GOLD_PRICE_TARGET_JOB }} --resource-group ${{ env.RESOURCE_GROUP }}

      - name: Trigger Earnings Gold Job
        if: ${{ github.event.inputs.job == 'all' || github.event.inputs.job == 'gold_earnings' || github.event.inputs.job == 'gold_earnings_by_date' }}
        run: az containerapp job start --name ${{ env.GOLD_EARNINGS_JOB }} --resource-group ${{ env.RESOURCE_GROUP }}

